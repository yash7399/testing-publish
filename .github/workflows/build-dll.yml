name: Build DLLs with MSBuild (Self-Hosted)

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  build:
    name: Build and Generate DLLs
    runs-on: self-hosted        # ðŸ‘ˆ your local runner
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup MSBuild Path
        run: |
          echo "Using MSBuild from Visual Studio 2022..."
          $env:Path += ';C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin'

      - name: Build solution and generate DLLs
        run: |
          Write-Host "ðŸ”¹ Starting MSBuild..."
          & "C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe" "CommonExtranet.sln" /p:Configuration=Release /p:OutputPath=dll /p:Platform="Any CPU"
          Write-Host "âœ… Build completed successfully."
      
      - name: List generated DLLs
        run: |
          Write-Host "ðŸ“¦ DLL files generated:"
          Get-ChildItem -Path dll -Recurse -Include *.dll | ForEach-Object { Write-Host $_.FullName }

      - name: Upload DLL artifacts
        uses: actions/upload-artifact@v4
        with:
          name: compiled-dlls
          path: dll/
