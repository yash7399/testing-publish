name: Build DLLs with MSBuild (Self-Hosted)

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  build:
    name: Build and Generate DLLs
    runs-on: self-hosted

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup MSBuild Path
        shell: powershell
        run: |
          Write-Host 'Using MSBuild from Visual Studio 2022...'
          $env:Path += ';C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin'

      - name: Build solution and generate DLLs
        shell: powershell
        run: |
          Write-Host 'Starting MSBuild...'
          & 'C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe' 'C:\Users\yashh\Desktop\testing-publish\CommonExtranet.sln' /p:Configuration=Release /p:OutputPath=dll /p:Platform='Any CPU'
          Write-Host 'Build completed successfully.'

      - name: List generated DLLs
        shell: powershell
        run: |
          Write-Host 'DLL files generated:'
          Get-ChildItem -Path dll -Recurse -Include *.dll | ForEach-Object { Write-Host $_.FullName }

      - name: Upload DLL artifacts
        uses: actions/upload-artifact@v4
        with:
          name: compiled-dlls
          path: dll/
