name: Build and Generate DLLs

on:
  push:
    branches: [ master ]

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build with MSBuild
        shell: powershell
        run: |
          Write-Host "üîπ Setting up paths..."
          $solutionPath = "C:\Users\yashh\Desktop\testing-publish\CommonExtranet.sln"
          $outputPath = "$env:GITHUB_WORKSPACE\SMSInterface\Bin"

          if (!(Test-Path $outputPath)) {
            New-Item -ItemType Directory -Path $outputPath | Out-Null
            Write-Host "‚úÖ Created output directory: $outputPath"
          }

          Write-Host "üîπ Starting MSBuild..."
          & "C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe" $solutionPath /p:Configuration=Release /p:OutputPath=$outputPath /p:Platform="Any CPU"
          Write-Host "‚úÖ Build completed successfully."

      - name: Verify DLLs
        shell: powershell
        run: |
          $dllPath = "$env:GITHUB_WORKSPACE\SMSInterface\Bin"
          if (Test-Path $dllPath) {
            $dlls = Get-ChildItem -Path $dllPath -Recurse -Include *.dll
            if ($dlls) {
              Write-Host "‚úÖ DLL files generated:"
              $dlls | ForEach-Object { Write-Host $_.FullName }
            } else {
              Write-Host "‚ö†Ô∏è Build succeeded but no DLL files found inside $dllPath"
            }
          } else {
            Write-Host "‚ùå DLL folder not found: $dllPath"
            exit 1
          }

      - name: Upload DLLs as Artifacts
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: generated-dlls
          path: SMSInterface/Bin/
