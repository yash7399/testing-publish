name: Build and Generate DLLs

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      # 1Ô∏è‚É£ Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Setup MSBuild environment
      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v2

      # 3Ô∏è‚É£ Build solution with full local path
      - name: Build solution and generate DLLs
        shell: powershell
        run: |
          Write-Host 'üîπ Starting MSBuild...'
          $solutionPath = 'C:\Users\yashh\Desktop\testing-publish\CommonExtranet.sln'
          $outputPath = 'C:\Users\yashh\Desktop\testing-publish\dll'
          
          # Ensure DLL folder exists
          if (-Not (Test-Path $outputPath)) {
            New-Item -ItemType Directory -Path $outputPath | Out-Null
          }
      
          # Run MSBuild
          & 'C:\Program Files\Microsoft Visual Studio\2022\Community\MSBuild\Current\Bin\MSBuild.exe' `
            $solutionPath /p:Configuration=Release /p:OutputPath=$outputPath /p:Platform='Any CPU'
      
          Write-Host '‚úÖ Build completed successfully.'
          Write-Host "DLLs should be inside $outputPath"


      # 4Ô∏è‚É£ List generated DLL files
      - name: List generated DLLs
        shell: powershell
        run: |
          $dllPath = "C:\Users\yashh\Desktop\testing-publish\dll"
          Write-Host "üîπ DLL files generated at $dllPath"
          if (Test-Path $dllPath) {
            Get-ChildItem -Path $dllPath -Recurse -Include *.dll | ForEach-Object {
              Write-Host $_.FullName
            }
          } else {
            Write-Host "‚ö†Ô∏è DLL path not found: $dllPath"
            exit 1
          }

      # 5Ô∏è‚É£ Upload DLLs as GitHub artifact
      - name: Upload DLL artifacts
        uses: actions/upload-artifact@v4
        with:
          name: compiled-dlls
          path: C:\Users\yashh\Desktop\testing-publish\dll
